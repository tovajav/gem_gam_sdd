var gam={mobileSmall:580,mobile:767,tablet:1024,firstTimeTabletMobile:true,firstTimeDesktop:true,init:function(){if($("body").hasClass("editionCMS")){$(".PRS_COLONNAGEBAS").closest(".edition").addClass("PRS_COLONNAGEBAS_EDITION");$(".PRS_COLONNAGEBAS_EDITION").wrapAll('<div class="PRS_COLONNAGEBAS_WRAPPER">')}else{$(".PRS_COLONNAGEBAS").wrapAll('<div class="PRS_COLONNAGEBAS_WRAPPER">')}if(navigator.share&&/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)){$("#shareButton").on("click",function(){navigator.share({title:"Grenoble Alpes Métropole",url:window.location.href})})}else{$("#shareButton").addClass("aria-toggle");cmsCore.ariaInit($("#share"))}$("div.filtre").find("a.selected").each(function(){$(this).attr("title",$(this).text()+" - Page active")});let taille=Cookies.get("btnTaille")!==undefined?Cookies.get("btnTaille"):0;gam.accessibilite.btnTaille(taille);let ligne=Cookies.get("btnLigne")!==undefined?Cookies.get("btnLigne"):0;gam.accessibilite.btnLigne(ligne);let mode=Cookies.get("btnMode")!==undefined?Cookies.get("btnMode"):"clair";gam.accessibilite.btnMode(mode);let animation=Cookies.get("btnAnimation")!==undefined?Cookies.get("btnAnimation"):"on";gam.accessibilite.btnAnimation(animation);$("#accessibiliteBtn").on("click",function(){if($(this).data("loaded")!=="1"){$("#accessibiliteContainer").load("/include/gabarit_site/GAB_LAMETRO/inc.accessibilite.php",function(){cmsCore.ariaInit($(this));gam.accessibilite.btnTaille(taille);gam.accessibilite.btnLigne(ligne);gam.accessibilite.btnMode(mode);gam.accessibilite.btnAnimation(animation);$("#btnTailleMoins").on("click",function(){taille--;gam.accessibilite.btnTaille(taille)});$("#btnTaillePlus").on("click",function(){taille++;gam.accessibilite.btnTaille(taille)});$("#btnLigneMoins").on("click",function(){ligne--;gam.accessibilite.btnLigne(ligne)});$("#btnLignePlus").on("click",function(){ligne++;gam.accessibilite.btnLigne(ligne)});$("#btnModeClair").on("click",function(){mode="clair";gam.accessibilite.btnMode(mode)});$("#btnModeSombre").on("click",function(){mode="sombre";gam.accessibilite.btnMode(mode)});$("#btnAnimationOn").on("click",function(){animation="on";gam.accessibilite.btnAnimation(animation)});$("#btnAnimationOff").on("click",function(){animation="off";gam.accessibilite.btnAnimation(animation)});$("#btnCancel").on("click",function(){taille=ligne=0;clair=true;animation="on";gam.accessibilite.btnTaille(taille);gam.accessibilite.btnLigne(ligne);gam.accessibilite.btnAnimation(animation)})});$(this).data("loaded","1");$("#flashInfoContainer").slideUp()}});$("#googleBtn").on("click",function(){$("#traduction").append('<script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"><\/script>')});window.addEventListener("tac.root_available",function(){$("#tarteaucitronAllAllowed").html("Tout accepter et fermer");$("#tarteaucitronAllDenied").html("Tout refuser et fermer");$("#tarteaucitronAllAllowed, #tarteaucitronAllDenied").on("click",function(){tarteaucitron.userInterface.closePanel()})});$("#accesRapideBtn").on("click",function(){$("body").toggleClass("menu-opened");$("#accesRapideContainer").toggleClass("is-opened");if($(this).data("loaded")!=="1"){$("#accesRapideContainer").load("/include/gabarit_site/GAB_LAMETRO/inc.accesRapide.php",function(){cmsCore.ariaInit($(this))});$(this).data("loaded","1")}});$(window).on("load resize orientationchange",function(){if($(window).width()>gam.tablet){$("#menuPrincipal").removeAttr("role").removeAttr("aria-labelledby").removeAttr("aria-modal")}else{$("#menuPrincipal").attr("role","dialog").attr("aria-labelledby","menuPrincipalTitle").attr("aria-modal","true");gam.modal.init($("#menuBtn"),$("#menuPrincipal"),$("#menuCloseBtn"),true)}});$(window).on("load resize orientationchange",function(){if($(window).width()>gam.tablet){$("#navCitoyenContainer").insertAfter("#espaceCitoyenBtn");$("#espaceCitoyenBtnTap").addClass("aria-toggle")}else{$("#navCitoyenContainer").insertAfter("#menuPrincipal");$("#navCitoyenContainer").attr("role","dialog").attr("aria-modal","true").removeAttr("aria-hidden");$("#espaceCitoyenBtnTap").removeAttr("data-focus").removeAttr("aria-controls").removeClass("aria-toggle");gam.modal.init($("#espaceCitoyenBtnTap"),$("#navCitoyenContainer"),$("#espaceCitoyenBtnClose"),true)}});if(window.location.hash&&$(window.location.hash).length){$(window).load(function(){$(".paginationNB",$(window.location.hash)).attr("tabindex",-1).focus();if($(window.location.hash).hasClass("PRS_PLIABLE")){setTimeout(function(){$(".paginationNB",$(window.location.hash)).attr("tabindex",-1).focus()},100)}})}const $navBarCitoyen=$("#navCitoyenContainer");let $deroulement=0;$navBarCitoyen.hide();$("#espaceCitoyenBtn").on("click",function(){if($deroulement){$navBarCitoyen.fadeOut(1e3);$deroulement=0}else{$navBarCitoyen.show();$deroulement=1}});$("#tarteaucitronAlertBigBottom").find(".tarteaucitronCTAButton").on("click",function(){if($("#flashInfoTopClose").length>0){$("#flashInfoTopClose").focus()}});$("#tarteaucitronClosePanel").on("click",function(){if($("#flashInfoTopClose").length>0){$("#flashInfoTopClose").focus()}});$("#colonneGauche").find(".PRS_ACCORDEON").each(function(){const $div=$(this);if($(this).find(".innerParagraphe > h2").length){if(!$div.hasClass("PRS_PLIABLE")){$div.addClass("PRS_PLIABLE plie")}}});if(window.location.href.includes("idPara=")){const searchParams=new URLSearchParams(window.location.search);const parID="#par"+searchParams.get("idPara");if($(parID).hasClass("PRS_ACCORDEON TPL_FAQLISTE")||$(parID).hasClass("PRS_ACCORDEON TPL_AGENDALISTE")||$(parID).hasClass("PRS_ACCORDEON TPL_AGENDALISTETHEMATIQUE")){setTimeout(function(){$("html, body").animate({scrollTop:$(parID).offset().top},"slow");$(parID).find("h2 button").trigger("click")},1)}}function getParameterByName(name,url){if(!url)url=window.location.href;name=name.replace(/[\[\]]/g,"\\$&");var regex=new RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)"),results=regex.exec(url);if(!results)return null;if(!results[2])return"";return decodeURIComponent(results[2].replace(/\+/g," "))}var paramValue=getParameterByName("fromListActu");if(paramValue!==null){const $url=SERVER_ROOT+"include/ajax/ajax.actualiteAccrochePage.php?idtf="+paramValue;$.ajax({url:$url,method:"GET",success:function(response){$(".accrochePage").text(response)}})}gam.initBis($(document));gam.search.init();gam.satisfaction.init();gam.lazyloading.init();gam.espaceCitoyen.ButtonAddOrDeleteFav.init()},modal:{init:function(btnOpen,$modal,btnClose,animation=false){btnOpen.on("click",function(){if($modal.hasClass("is-opened")){gam.modal.closeModal(btnOpen,$modal,animation)}else{gam.modal.openModal(btnOpen,$modal,animation)}});$(document).on("keydown",function(e){if(e.key==="Escape"){if($modal.hasClass("is-opened")){gam.modal.closeModal(btnOpen,$modal,animation)}}})},openModal:function(btnOpen,$modal,animation){$("body").addClass("menu-opened");if(animation){$modal.show();btnOpen.addClass("is-open");setTimeout(function(){$modal.addClass("is-opened")},1)}else{btnOpen.addClass("is-open");$modal.addClass("is-opened")}gam.trapFocusModal($modal)},closeModal:function(btnOpen,$modal,animation){if(animation){$modal.removeClass("is-opened");setTimeout(function(){$modal.hide();btnOpen.focus();btnOpen.removeClass("is-open")},300)}else{$("body").removeClass("menu-opened");$modal.removeClass("is-opened");btnOpen.focus();btnOpen.removeClass("is-open")}}},trapFocusModal:function(elem){var tabbable=elem.find('select, input, textarea, button, a, [tabindex]:not([tabindex="-1"])').filter(":visible");var firstTabbable=tabbable.first();var lastTabbable=tabbable.last();firstTabbable.focus();lastTabbable.on("keydown",function(e){if(e.which===9&&!e.shiftKey){e.preventDefault();firstTabbable.focus()}});firstTabbable.on("keydown",function(e){if(e.which===9&&e.shiftKey){e.preventDefault();lastTabbable.focus()}});elem.on("keyup",function(e){if(e.keyCode===27){elem.hide()}})},initBis:function($root){$('input[type="email"]',$root).on("change",function(){if(this.validity.typeMismatch){this.setCustomValidity("Saisie invalide, format attendu : sophie.martin@exemple.com");this.reportValidity()}else{this.setCustomValidity("")}});$($root).find(".PRS_PLIABLE").each(function(){const $elt=$(this);$elt.addClass("plie");gam.pliable($elt)});$(".ajaxContent",$root).on("click",".paginationReglette a",function(){const $contenaire=$(this).closest(".ajaxContent");const $reglette=$contenaire.find(".paginationReglette");let url=$reglette.data("url");url=`${window.SERVER_ROOT}include/tpl/GAB_LAMETRO/${url}`;url+=$(this).attr("href").substring($(this).attr("href").indexOf("?"));url+="&idtf="+$("#document").data("idtf");$reglette.empty();if($contenaire.data(url)){$contenaire.empty().append($contenaire.data(url))}else{$.get(url,function(data){const $html=$(data).html();$contenaire.data(url,$html);$contenaire.empty().append($html)})}window.history.replaceState({},"",$(this).attr("href"));const $para=$contenaire.closest("div.paragraphe");cmsCore.scroll($para,0,true);$(".paginationNB",$para).attr("tabindex",-1).focus();if(/- Page \d+$/.test(document.title)){document.title=`${document.title.substring(0,document.title.lastIndexOf("- Page "))}- Page ${$(this).data("page")}`}else{document.title=document.title+" - Page "+$(this).data("page")}return false})},gestionEtoile:function(){$("input[required], select[required], textarea[required]").not("input:checkbox, input:radio").each(function(){if(!$('label[for="'+$(this).attr("id")+'"]').find("span").length){$('label[for="'+$(this).attr("id")+'"]').append(' <span style="color:red">*</span>')}})},storeMapCookie:function(idMap){const date=new Date;date.setTime(date.getTime()+24*60*60*1e3);expires="; expires="+date.toUTCString();document.cookie=idMap+"="+"open"+expires+"; path=/"},getCookie:function(name){const nameEQ=name+"=";const ca=document.cookie.split(";");for(let i=0;i<ca.length;i++){let c=ca[i];while(c.charAt(0)==" ")c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length)}return null},checkOpenedMap:function(){if($(".btnMap").length){$(".gmaps").each((i,map)=>{const mapId=$(map).attr("id");const functionName=mapId+"Init";if(gam.getCookie(mapId)){const btn=$(map).siblings(".btnMap");if(btn){$(map).show(function(){window[functionName]()});btn.remove()}}})}},accessibilite:{btnTaille:function(taille){$("#btnTailleMoins").prop("disabled",taille<=0);$("#btnTaillePlus").prop("disabled",taille>=4);$("html").attr("data-taille",taille);Cookies.set("btnTaille",taille,{expires:365})},btnLigne:function(ligne){$("#btnLigneMoins").prop("disabled",ligne<=0);$("#btnLignePlus").prop("disabled",ligne>=4);$("body").attr("data-ligne",ligne);Cookies.set("btnLigne",ligne,{expires:365})},btnMode:function(mode){$("#btnModeClair").prop("disabled",mode!=="sombre");$("#btnModeSombre").prop("disabled",mode==="sombre");$("body").attr("data-mode",mode);Cookies.set("btnMode",mode,{expires:365})},btnAnimation:function(animation){$("#btnAnimationOn").prop("disabled",animation!=="off");$("#btnAnimationOff").prop("disabled",animation==="off");$("body").attr("data-animation",animation);Cookies.set("btnAnimation",animation,{expires:365})}},copy:function(){const $input=$(`<input type="text" value="${window.location.href}">`);$("body").append($input);$input.get(0).select();document.execCommand("copy");$input.remove()},pliable:function($div,majSommaire){const $inner=$div.children().first();const $h2=$inner.children("h2, .titre2").first();if($h2.length){if(!$div.attr("id")){$div.attr("id","pa"+Math.floor(Math.random()*1e5))}$inner.data("oldHeight",$inner.outerHeight()).wrapInner('<div class="innerInnerParagraphe" aria-hidden="true"></div>').prepend($h2);const $innerInner=$inner.children(".innerInnerParagraphe").first();$innerInner.hide();$h2.wrapInner(`<button type="button" class="action" aria-expanded="false" aria-controls="${$div.attr("id")}"></button>`);$("button.action",$div).first().on("click",function(ev,trigerred,majHistory){const $button=$(this);if($h2.data("load")){let url="/include/gabarit_site/GAB_LAMETRO/ajax.paragraphe.php";url+=window.location.search?window.location.search+"&":"?";url+="idPara="+$h2.data("load");$innerInner.load(url,function(){$h2.data("load","");gam.pliableClic($div,$button,$innerInner,majSommaire,trigerred);gam.initBis($innerInner);cmsCore.ariaInit($innerInner);if(!$h2.parent().parent().hasClass("TPL_FORMULAIRE")&&osm&&osm.map){osm.map.invalidateSize();if(osm.bound){osm.map.fitBounds(osm.bound,{padding:[10,10]})}}gam.gestionEtoile()})}else{gam.pliableClic($div,$button,$innerInner,majSommaire,trigerred)}if(majHistory){window.history.replaceState({},"",window.location.pathname+window.location.search+"#"+$div.attr("id"))}})}},pliableClic:function($div,$button,$innerInner,majSommaire,trigerred){if(trigerred){let delta=-5;if($("#bandeauHaut").css("position")=="fixed"){delta-=$("#bandeauHaut").height()}cmsCore.scroll($div,delta,true)}if(majSommaire){gam.sommaire.div.find("li").removeClass("active").removeAttr("aria-current");gam.sommaire.cA.each(function(){if($(this).attr("href").substring(1)===$div.attr("id")){$(this).closest("li").addClass("active").attr("aria-current",true);return false}return true})}if($button.attr("aria-expanded")==="false"){$button.attr("aria-expanded","true");$div.removeClass("plie");$innerInner.removeAttr("aria-hidden").slideDown(function(){$(".spanImgContainer",$div).width(function(){$(this).width("auto");let $img=$(".spanImgOuter img",$(this)).outerWidth();let $parent=$(this).closest(".innerParagraphe").width();if($img>$parent){return $parent}return $img})})}else if(!trigerred){$innerInner.attr("aria-hidden","true").slideUp(function(){$button.attr("aria-expanded","false");$div.addClass("plie")})}},sommaire:{div:null,cA:null,init:function(){gam.sommaire.div=$("#sommaire");gam.sommaire.cA=gam.sommaire.div.find(".menu a");let renderTitle=false;gam.sommaire.cA.each(function(){if(!$($(this).attr("href")).length){$(this).closest("li").remove()}else{renderTitle=true;$(this).addClass("noScroll")}});if(!renderTitle){$("#sommaireH2").remove()}$(window).on("load resize orientationchange",function(){$(window).off("scroll.sommaire");if($(window).width()>gam.mobile){const deltaTop=$(window).width()<gam.tablet?$("#bandeauHaut").height():0;const deltaBottom=$(window).width()<gam.tablet?$("#tapbar").height():0;const height=gam.sommaire.div.outerHeight();$(window).on("scroll.sommaire",function(){const top=$("#colonneCentre").offset().top;const pos=$(window).scrollTop()+deltaTop;const bottom=$("#colonneDroite").length?$("#colonneDroite").offset().top-25:$("#newsletter").offset().top-45;if(pos+height>bottom){gam.sommaire.div.removeClass("sticky").addClass("bottom").removeAttr("style")}else if(pos>top){gam.sommaire.div.removeClass("bottom").addClass("sticky").css({height:$(window).outerHeight()-deltaTop-deltaBottom})}else{gam.sommaire.div.removeClass("sticky bottom").removeAttr("style")}}).trigger("scroll.sommaire")}else{gam.sommaire.div.removeClass("sticky bottom").removeAttr("style")}});$("#colonneCentre").find("div.innerParagraphe").each(function(){if($(this).children("h2").length){const $div=$(this).parent();if(!$div.hasClass("PRS_PLIABLE")){$div.addClass("PRS_PLIABLE plie");gam.pliable($div,[true])}}});if(window.location.hash&&$(window.location.hash).length){$(window.location.hash).find(".action").first().trigger("click",[true])}$(document).on("click","a[href]",function(){const hash=$(this).attr("href").indexOf("#");if(hash!==-1){$($(this).attr("href").substring(hash)).find(".action").first().trigger("click",[true,true])}})}},flashInfo:{init:function(){$("#flashInfoTopClose").on("click",function(){Cookies.set("flashInfo",$(this).data("time"),{expires:365});Cookies.set("animationFlashInfo",$("#flashInfoBtn").data("id"),{expires:.5});$("#lienEvitement").find("a:first").focus()});$(".flashInfoContainer__content").find("a").on("click",function(e){e.preventDefault();Cookies.set("flashInfo",$("#flashInfoTopClose").data("time"),{expires:365});Cookies.set("animationFlashInfo",$("#flashInfoBtn").data("id"),{expires:.5});window.location.href=$(this).attr("href")});if($(window).width()<=gam.tablet&&$("#flashInfoContainer").hasClass("alert")){var flashModal=$("#flashInfoContainer");var flashOverlay=$("#flashInfoContainerModal");var flashCloseBtn=$("#flashInfoTopClose");var flashModalBtn=$("#flashInfoBtn");flashModal.attr("role","dialog").attr("aria-modal","true").removeClass("is-open").addClass("closed").attr("aria-labelledby","flashInfoContainerTitle");flashCloseBtn.attr("aria-controls","flashInfoContainer");flashModalBtn.removeAttr("aria-controls").attr("aria-expanded","false");function closeModalFlash(){flashModal.css("display","none").removeClass("is-open").addClass("closed");flashOverlay.removeClass("active");flashModalBtn.attr("aria-expanded","false").show();$("body").removeClass("u-overflow-hidden-y-tablet");$("#document > :not(#flashInfoContainer)").removeAttr("inert");if(Cookies.get("flashInfo-firstopening")){if($(".modal-popin.open").length){$(".modal-popin .modal-close").focus()}else{$("#lienEvitement").find("li:visible:first a").focus()}}else{flashModalBtn.focus()}Cookies.set("flashInfo",$("#flashInfoTopClose").data("time"),{expires:365});Cookies.remove("flashInfo-firstopening")}function openModalFlash(){flashModal.css("display","block").removeClass("closed").addClass("is-open");flashOverlay.addClass("active");flashModalBtn.attr("aria-expanded","true").hide();$("body").addClass("u-overflow-hidden-y-tablet");$("#document > :not(#flashInfoContainer)").attr("inert","inert");Cookies.remove("flashInfo");if(!Cookies.get("flashInfo-firstopening")){flashCloseBtn.focus()}}if(Cookies.get("flashInfo")==$("#flashInfoTopClose").data("time")){}else{Cookies.set("flashInfo-firstopening");openModalFlash()}flashOverlay.on("click",function(){closeModalFlash()});flashCloseBtn.on("click",function(){setTimeout(function(){closeModalFlash()},1)});$(document).keydown(function(e){if(e.keyCode==27){closeModalFlash()}});flashModalBtn.on("click",function(e,triggered){if(!triggered){openModalFlash()}});const focusableElements='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';const firstFocusableElement=flashModal.find(focusableElements).eq(0);const focusableContent=flashModal.find(focusableElements);const lastFocusableElement=focusableContent.eq(focusableContent.length-1);$(document).on("keydown",function(e){let isTabPressed=e.key==="Tab"||e.keyCode===9;if(!isTabPressed){return}if(e.shiftKey){if(document.activeElement===firstFocusableElement[0]){lastFocusableElement.focus();e.preventDefault()}}else{if(document.activeElement===lastFocusableElement[0]){firstFocusableElement.focus();e.preventDefault()}}})}$("#flashInfoBtn").on("click",function(ev,triggered){Cookies.set("animationFlashInfo",$("#flashInfoBtn").data("id"),{expires:.5});$("#flashInfoBtn").data("animationFlashInfo","false");$("#flashInfoBtn").attr("data-animationFlashInfo","false");if(!triggered){if($(window).width()<=gam.tablet&&$("#flashInfoContainer").hasClass("alert")){}else{if($("#flashInfoContainer").attr("aria-hidden")==="true"){Cookies.set("flashInfo",$("#flashInfoTopClose").data("time"),{expires:365})}else{Cookies.remove("flashInfo")}}}});$(window).on("load resize orientationchange",function(){if($(window).width()<=gam.tablet){$("#flashInfoBtn").insertBefore("#hautDePage")}else{$("#flashInfoBtn").insertAfter("#menu")}})}},search:{init:function(){$("#searchString, #searchStringTop").attr("autocomplete","off").autocomplete({source:"/include/gabarit_site/GAB_LAMETRO/ajax.search.php",minLength:3,delay:500,select:function(event,ui){window.location.href=ui.item.url},position:{my:"left top",at:"left bottom"},messages:{noResults:"Pas de résultat.",results:function(e){return e+(e>1?" résultats sont disponibles":" résultat est disponible")+", utiliser les flèches haut et bas pour naviguer."}}})}},satisfaction:{init:function(){$(".condition").hide();$("#satisfait_1").on("click",function(){$("#cgu, #CAP_REPONSE, #detailSatisfaction, #emailSatisfaction").prop("required",false);$(".condition").show();$(".condition0").hide()}).filter(":checked").trigger("click");$("#satisfait_0").on("click",function(){$("#cgu, #CAP_REPONSE, #detailSatisfaction, #emailSatisfaction").prop("required",true);$(".condition").show()}).filter(":checked").trigger("click")}},dechet:{initDechet:function(){$("#dechet").attr("autocomplete","off").on("focus",function(){$("#dechetID").val("")}).autocomplete({source:"/include/tpl/GAB_LAMETRO/ajax.dechet.php",minLength:3,select:function(event,ui){$("#dechetID").val(ui.item.idtf);$("#dechet").val(ui.item.value).closest("form").submit()},messages:{noResults:"Pas de résultat.",results:function(e){return e+(e>1?" résultats sont disponibles":" résultat est disponible")+", utiliser les flèches haut et bas pour naviguer."}}})},initDechetterie:function(){$("#dechet").attr("autocomplete","off").autocomplete({source:"/include/tpl/GAB_LAMETRO/ajax.dechet.php",minLength:2,select:function(event,ui){$("#listeDechet").show().append(`<li title="Supprimer ce déchet" data-idtf="${ui.item.idtf}">${ui.item.value}</li>`);$("#dechets").val(`${$("#dechets").val()}@${ui.item.idtf}`)},close:function(){$("#dechet").val("")},messages:{noResults:"Pas de résultat.",results:function(e){return e+(e>1?" résultats sont disponibles":" résultat est disponible")+", utiliser les flèches haut et bas pour naviguer."}}});$("#listeDechet").on("click","li",function(){$(this).remove();$("#dechets").val($("#dechets").val().replace(`@${$(this).data("idtf")}`,""))});$(".closePopup").on("click",function(){$(this).parent().hide()})}},jourCollecte:{init:function(){$("#commune").on("change",function(e,triggered){if(!triggered){$("#adresse").val("")}if($("#commune").val()!==""){$.get("/include/tpl/GAB_LAMETRO/ajax.jourCollecte.php?check="+$("#commune").val(),function(data){if(data>10){$("#adresseP").show();$("#rueP").show();$("#adresse").prop("required",true);gam.gestionEtoile()}else{$("#adresseP").hide();$("#rueP").hide();$("#adresse").prop("required",false)}})}else{$("#adresseP").hide();$("#rueP").hide();$("#adresse").prop("required",false)}}).trigger("change",[true]);$("#adresse").attr("autocomplete","off").autocomplete({source:function(request,response){$.getJSON("/include/tpl/GAB_LAMETRO/ajax.jourCollecte.php",{ville:$("#commune").val(),term:$("#adresse").val()},response)},minLength:3,messages:{noResults:"Pas de résultat.",results:function(e){return e+(e>1?" résultats sont disponibles":" résultat est disponible")+", utiliser les flèches haut et bas pour naviguer."}}});$(".closePopup").on("click",function(){$(this).parent().hide()})}},popin:{init:function(){var modal=$(".popin");modal.each(function(i,elem){var $elem=$(elem);var overlay=$(".modal-close, ."+$elem.data("overlay"));if($elem.hasClass("open")){$elem.css("display","block");overlay.addClass("active")}overlay.on("click",function(){modal.css("display","none");overlay.removeClass("active");$("#lienEvitement").find("a:first").focus()});$(window).on("click",function(event){if(event.target==modal){modal.css("display","none");overlay.removeClass("active");$("#lienEvitement").find("a:first").focus()}});$(window).on("click",function(event){if(event.target==$elem){$elem.css("display","none");overlay.removeClass("active")}});$(document).keydown(function(e){if(e.keyCode==27){$elem.css("display","none");overlay.removeClass("active")}});const focusableElements='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';const firstFocusableElement=$elem.find(focusableElements).eq(0);const focusableContent=$elem.find(focusableElements);const lastFocusableElement=focusableContent.eq(focusableContent.length-1);$(document).on("keydown",function(e){let isTabPressed=e.key==="Tab"||e.keyCode===9;if(!isTabPressed){return}if(e.shiftKey){if(document.activeElement===firstFocusableElement[0]){lastFocusableElement.focus();e.preventDefault()}}else{if(document.activeElement===lastFocusableElement[0]){firstFocusableElement.focus();e.preventDefault()}}});firstFocusableElement.focus()})}},marcheListe:{init:function(){$(".closePopup").on("click",function(){$(this).parent().hide()})}},lazyloading:{init:function(){$(window).load(function(){var imageContainer=$(".spanImgContainer");if(imageContainer.width()==0){imageContainer.css("width","")}})}},offreEmploi:{init:function(){const checkbox=document.querySelectorAll('input[type="checkbox"].js-offre_checkbox');const select=document.querySelector("select.js-offre_select");checkbox.forEach(checkbox=>checkbox.addEventListener("change",function(e){gam.offreEmploi.updateList()}));select.addEventListener("change",function(e){gam.offreEmploi.updateList()})},updateList:function(){const checkboxChecked=document.querySelectorAll('input[type="checkbox"].js-offre_checkbox:checked');const select=document.querySelector("select.js-offre_select");const type=document.querySelector("#type");const searchParams=new URLSearchParams;searchParams.set("type",type.value);searchParams.set("domaine",select.value);checkboxChecked.forEach(checkbox=>{searchParams.append("categorie[]",checkbox.value)});$.ajax({url:SERVER_ROOT+"include/tpl/GAB_LAMETRO/ajax.offreEmploi.php",data:searchParams.toString(),method:"GET",dataType:"html",success:function(response){$("#offreContent").html(response)}});return false}},frise:{init:function(){let initialSlide=0;let slidesToScroll=1;let slidesToShow=3;const $frise=$(".js-list-frise");const $mea=$(".mea");gam.frise.accessibility();if($frise.closest("section").is("#colonneGauche")||$frise.closest("section").is("#colonneDroite")){slidesToShow=5}if($mea.length>0){initialSlide=$mea.data("ordre")}$frise.slick({initialSlide:initialSlide,slidesToShow:slidesToShow,slidesToScroll:slidesToScroll,dots:true,infinite:false,appendDots:$(".list-frise__control"),prevArrow:$(".list-frise__control .slick-prev"),nextArrow:$(".list-frise__control .slick-next"),responsive:[{breakpoint:1025,settings:{slidesToShow:3,slidesToScroll:3}},{breakpoint:581,settings:{slidesToShow:1,slidesToScroll:1}}]});gam.frise.fixHeight($frise);if(($frise.closest("section").is("#colonneGauche")||$frise.closest("section").is("#colonneDroite"))&&!$frise.closest(".PRS_ACCORDEON").length){setTimeout(function(){const listHeight=$frise.find(".list-frise__item").height();gam.frise.fixPadding(listHeight,$frise)},20)}else{setTimeout(function(){$frise.slick("refresh");setTimeout(function(){gam.frise.fixHeight($frise)},10);setTimeout(function(){const listHeight=$frise.find(".list-frise__item").height();gam.frise.fixPadding(listHeight,$frise)},10)},20)}},fixHeight:function(element){const list=element.find(".list-frise__item");let counter=0;for(let i=0;i<list.length;i++){const singleHeight=list[i].offsetHeight;if(counter<singleHeight){counter=singleHeight}}for(let i=0;i<list.length;i++){list[i].style.height=`${counter}px`}},fixPadding:function(listHeight,element){const listEven=element.find(".list-frise__item.even");const listOdd=element.find(".list-frise__item.odd");if($(window).width()>gam.mobileSmall){listEven.each(function(){$(this).css("padding-top",listHeight-20)});listOdd.each(function(){$(this).css("padding-bottom",listHeight)})}},accessibility:function(){const $friseContent=$(".js-frise-content");const $friseBtn=$(".js-frise-btn");$friseContent.hide();$friseBtn.on("click keypress",function(event){event.preventDefault();if(event.type==="click"||event.keyCode===13){if($friseBtn.attr("aria-expanded")==="false"){$friseBtn.attr("aria-expanded","true");$friseContent.removeAttr("aria-hidden").slideDown()}else{$friseBtn.attr("aria-expanded","false");$friseContent.attr("aria-hidden","true").slideUp()}}})}},espaceCitoyen:{actualite:{init:function(){gam.espaceCitoyen.actualite.initFav();gam.espaceCitoyen.actualite.initFilter()},initFav:function(){$(".js-fav-theme").on("click",function(){const idThematique=$(this).attr("id");const idCitoyen=$("#idCitoyen").val();if($(this).hasClass("all")){$.get(SERVER_ROOT+"include/ajax/ajax.liaisonCitoyenActualiteThematique.php?all=1&idCitoyen="+idCitoyen).done(function(){$.get(SERVER_ROOT+"include/tpl/GAB_LAMETRO/ajax.mesActualitesFilter.php?idtf="+$("#idtf").val(),function(data){$(".actuFilter").html(data);gam.espaceCitoyen.actualite.initFilter()}).done(function(){let aID=[];$(".js-filter-actu.selected").each(function(){if(!$(this).hasClass("all")){aID.push($(this).data("id"))}});$.get(SERVER_ROOT+"include/tpl/GAB_LAMETRO/ajax.mesActualite.php?idtf="+$("#idtf").val()+"&idThematique="+aID.join("-"),function(data){$(".actuContent").html(data)})});$(".js-fav-theme").not(".all").each(function(){if(!$(this).hasClass("selected")){$(this).addClass("selected");$(this).attr("aria-pressed","true")}})})}else{if($(this).hasClass("selected")){$.get(SERVER_ROOT+"include/ajax/ajax.liaisonCitoyenActualiteThematique.php?"+"idThematique="+parseInt(idThematique.match(/\d+/)[0],10)+"&idCitoyen="+idCitoyen+"&addOrDelete=delete").done(function(){$.get(SERVER_ROOT+"include/tpl/GAB_LAMETRO/ajax.mesActualitesFilter.php?idtf="+$("#idtf").val(),function(data){$(".actuFilter").html(data);gam.espaceCitoyen.actualite.initFilter()}).done(function(){let aID=[];$(".js-filter-actu.selected").each(function(){if(!$(this).hasClass("all")){aID.push($(this).data("id"))}});$.get(SERVER_ROOT+"include/tpl/GAB_LAMETRO/ajax.mesActualite.php?idtf="+$("#idtf").val()+"&idThematique="+aID.join("-"),function(data){$(".actuContent").html(data)})})});$(this).removeClass("selected");$(this).attr("aria-pressed","false")}else{$.get(SERVER_ROOT+"include/ajax/ajax.liaisonCitoyenActualiteThematique.php?"+"idThematique="+parseInt(idThematique.match(/\d+/)[0],10)+"&idCitoyen="+idCitoyen+"&addOrDelete=add").done(function(){$.get(SERVER_ROOT+"include/tpl/GAB_LAMETRO/ajax.mesActualitesFilter.php?idtf="+$("#idtf").val(),function(data){$(".actuFilter").html(data);gam.espaceCitoyen.actualite.initFilter()}).done(function(){let aID=[];$(".js-filter-actu.selected").each(function(){if(!$(this).hasClass("all")){aID.push($(this).data("id"))}});$.get(SERVER_ROOT+"include/tpl/GAB_LAMETRO/ajax.mesActualite.php?idtf="+$("#idtf").val()+"&idThematique="+aID.join("-"),function(data){$(".actuContent").html(data)})})});$(this).addClass("selected");$(this).attr("aria-pressed","true")}}$(".msgConfirm").append('<p role="alert">Votre sélection est enregistrée</p>');var $message=$(".msgConfirm p");setTimeout(function(){$message.fadeOut("slow",function(){$message.remove()})},2e3)})},initFilter:function(){$(".js-filter-actu").on("click",function(){if($(this).hasClass("selected")){$(this).removeClass("selected").attr("aria-pressed","false")}else{if($(this).hasClass("all")){$(".js-filter-actu").each(function(){$(this).removeClass("selected").attr("aria-pressed","false")})}else{if($(".all").hasClass("selected")){$(".all").removeClass("selected").attr("aria-pressed","false")}}$(this).addClass("selected").attr("aria-pressed","true")}let aID=[];$(".js-filter-actu.selected").each(function(){if(!$(this).hasClass("all")){aID.push($(this).data("id"))}});$.get(SERVER_ROOT+"include/tpl/GAB_LAMETRO/ajax.mesActualite.php?idtf="+$("#idtf").val()+"&idThematique="+aID.join("-"),function(data){$(".actuContent").html(data)})})}},ButtonAddOrDeleteFav:{init:function(){let $boutonAddDelete=$("#btnAddOrDelete, .btnDelete");$boutonAddDelete.on("click keypress",function(event){if(event.type==="click"||event.keyCode===13){const indicePage=$(this).data("indicepage");$.get(SERVER_ROOT+"include/ajax/ajax.liaisonCitoyenPage.php?idPage="+$(this).data("idpage")+"&idCitoyen="+$(this).data("idcitoyen")+"&addOrDelete="+$(this).data("addordelete")+"&PAR_TPL_IDENTIFIANT="+$(this).data("par_tpl_identifiant")+"&TPL_CODE="+$(this).data("tpl_code")).done(function(){const $inputValAddDelete=$("#addOrDelete");if($inputValAddDelete.val()=="add"){$inputValAddDelete.val("delete");$boutonAddDelete.removeClass("c-fav--add");$boutonAddDelete.addClass("c-fav--delete");$boutonAddDelete.html("Supprimer de mon espace");$boutonAddDelete.data("addordelete","delete")}else if($("#tplPageFavorites").length>0){$("#page_"+$("#idPage").val()).remove()}else{$inputValAddDelete.val("add");$boutonAddDelete.removeClass("c-fav--delete");$boutonAddDelete.addClass("c-fav--add");$boutonAddDelete.html("Ajouter à mon espace");$boutonAddDelete.data("addordelete","add")}$.get(SERVER_ROOT+"include/tpl/GAB_LAMETRO/ajax.mesPagesFavorites.php?indicePage="+indicePage,function(data){$("#content").html(data);if($(".btnDelete").length>0){gam.espaceCitoyen.ButtonAddOrDeleteFav.init()}})})}})}},monProfil:{init:function(){$("#CIT_ADRESSE").attr("autocomplete","off").autocomplete({source:function(request,response){$.getJSON("/include/tpl/GAB_LAMETRO/ajax.jourCollecte.php",{ville:decodeURIComponent(encodeURIComponent($("#ID_COMMUNE option:selected").html())),term:$("#CIT_ADRESSE").val()},response)},minLength:3,messages:{noResults:"Pas de résultat.",results:function(e){return e+(e>1?" résultats sont disponibles":" résultat est disponible")+", utiliser les flèches haut et bas pour naviguer."}}})}},colonneAVerre:{init:function(btn,mapId){$(btn).remove();this.map.init(mapId)},map:{div:null,pluginMap:null,citoyenMarker:null,lieuMarkers:[],init:function(mapId){this.div=$("#"+mapId);this.div.show();gam.storeMapCookie("mapLieu");this.pluginMap=osm.init(mapId);this.requestCitoyenMarker()},requestCitoyenMarker:function(){const params=new URLSearchParams(window.location.search);$.ajax({url:SERVER_ROOT+"include/tpl/GAB_LAMETRO/ajax.lieuCitoyenInformations.php",data:params.toString(),dataType:"json"}).done(function(response,status){if(status==="success"){this.addCitoyenMarker(response["longitude"],response["latitude"],response["html"],response["icon"]);this.requestLieuxMarker()}}.bind(this))},addCitoyenMarker:function(longitude,latitude,htmlPopup,markerIcon=null){let options={};if(markerIcon){options={icon:L.icon({iconUrl:markerIcon,iconAnchor:[16,37],popupAnchor:[0,-37]})}}this.citoyenMarker=osm.addMarker(latitude,longitude,options).bindPopup(htmlPopup,{autoPanPadding:L.point(60,10)})},requestLieuxMarker:function(){const ids=this.div.attr("id").replace(/mapLieu/g,"").split("-");const params=new URLSearchParams(window.location.search);ids.map(s=>params.append("thematique[]",s));$.ajax({url:SERVER_ROOT+"include/tpl/GAB_LAMETRO/ajax.lieuCitoyenInformations.php",data:params.toString(),dataType:"json"}).done(function(response,status){if(status==="success"&&response.length>0){let options={};response.forEach((lieu,key)=>{if(lieu.icon){options={icon:L.icon({iconUrl:lieu.icon,iconAnchor:[16,37],popupAnchor:[0,-37]})}}let marker=osm.addMarker(lieu.latitude,lieu.longitude,options).bindPopup(lieu.html,{autoPanPadding:L.point(60,10)});marker.distance=this.citoyenMarker.getLatLng().distanceTo(marker.getLatLng());let j=key-1;while(j>=0&&marker.distance<this.lieuMarkers[j].distance){this.lieuMarkers[j+1]=this.lieuMarkers[j];j-=1}this.lieuMarkers[j+1]=marker});if(this.lieuMarkers.length>3){let spliced=this.lieuMarkers.splice(0,3);this.lieuMarkers.forEach(markerToRemove=>markerToRemove.remove());this.lieuMarkers=spliced;osm.bound=L.latLngBounds(this.pluginMap.getCenter());this.lieuMarkers.forEach(marker=>osm.bound.extend(marker.getLatLng()));this.pluginMap.fitBounds(osm.bound,{padding:[10,10]})}}}.bind(this))}}}},newsletter:{init:function(){$("#moteurRecherche").on("submit",function(e){e.preventDefault();const $mail=$("#CIB_EMAIL").val();$.get(SERVER_ROOT+"include/tpl/GAB_LAMETRO/ajax.desinscriptionNewsletter.php?CIB_EMAIL="+$mail,function(data){$(".content").html(data)}).done(function(){gam.newsletter.unsubscribe($mail)})})},unsubscribe:function(mail){$(".eamBtnUnsuscribe").on("click",function(e){e.preventDefault();$.get(SERVER_ROOT+"include/ajax/ajax.desinscriptionNewsletterSubmit.php?CIB_ID="+$("#CIB_ID").val()+"&CIB_CODE="+$("#CIB_CODE").val()).done(function(){$.get(SERVER_ROOT+"include/tpl/GAB_LAMETRO/ajax.desinscriptionNewsletter.php?CIB_EMAIL="+mail,function(data){$(".content").html(data);$(".s-desinscription").append('<p role="alert" class="s-desinscription__confirm">Votre désinscription a bien été prise en compte</p>');gam.newsletter.unsubscribe()})})})}},agenda:{init:function(){$("#label_panelListe").on("click",function(){$(".filtre").find("a").each(function(){var url=$(this).attr("href").split("#")[0];$(this).attr("href",url+"#panelListe")})});$("#label_panelCarte").on("click",function(){$(".filtre").find("a").each(function(){var url=$(this).attr("href").split("#")[0];$(this).attr("href",url+"#panelCarte")})});$(".filtre").find("a").each(function(){var url=$(this).attr("href").split("#")[0];$(this).attr("href",url+window.location.hash)})}},pab:{tplParrainage:function(){gam.pab.initRequired();gam.pab.initAddInput();gam.pab.initCheckFormSubmit()},initRequired:function(){$(".filleulInput").on("keyup",function(){let required=false;$(this).find("input").each(function(){if($(this).val().length>0){required=true}});if(required){$(this).find("input").each(function(){$(this).prop("required",true);$(this).attr("required",true)})}else{$(this).find("input").each(function(){$(this).removeProp("required");$(this).removeAttr("required")})}})},initAddInput:function(){$(".js-parrainage-add").on("click",function(e){e.preventDefault();if($(".filleulInput").length<=9){let input=$(".filleulInput:last").clone();input.find("input").val("");var newLineLenght=$(".filleulInput").length+1;input.find(".js-parrainage-numero").html(newLineLenght);input.find('label[for^="FLL_NOM"]').attr("for","FLL_NOM"+newLineLenght);input.find('input[id^="FLL_NOM"]').attr("id","FLL_NOM"+newLineLenght);input.find('label[for^="FLL_PRENOM"]').attr("for","FLL_PRENOM"+newLineLenght);input.find('input[id^="FLL_PRENOM"]').attr("id","FLL_PRENOM"+newLineLenght);input.find('label[for^="FLL_MAIL"]').attr("for","FLL_MAIL"+newLineLenght);input.find('input[id^="FLL_MAIL"]').attr("id","FLL_MAIL"+newLineLenght);input.attr("aria-labelledby","s-parrainage__title"+newLineLenght);input.find(".s-parrainage__nb").attr("id","s-parrainage__title"+newLineLenght);input.insertAfter($(".filleulInput:last"));gam.pab.initRequired();if($(".filleulInput").length==10){$(".s-parrainage__add").remove()}$(".filleulInput:last input.FLL_NOM").focus()}else{window.alert("Vous ne pouvez pas parrainer plus de 10 personnes")}})},trapFocusModal:function(modalSelector){const focusableElements='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';const firstFocusableElement=modalSelector.find(focusableElements).eq(0);const focusableContent=modalSelector.find(focusableElements);const lastFocusableElement=focusableContent.eq(focusableContent.length-1);$(document).on("keydown",function(e){let isTabPressed=e.key==="Tab"||e.keyCode===9;if(!isTabPressed){return}if(e.shiftKey){if(document.activeElement===firstFocusableElement[0]){lastFocusableElement.focus();e.preventDefault()}}else{if(document.activeElement===lastFocusableElement[0]){firstFocusableElement.focus();e.preventDefault()}}});firstFocusableElement.focus()},initCheckFormSubmit:function(){$(".js-parrainage-form .submit").on("click",function(event){event.preventDefault();let ok=true;let errorMsg="";$(".js-parrainage-error").remove();$("#moteurRecherche input[required]").each(function(){if($(this).is(":checkbox")&&!$(this).prop("checked")){ok=false;errorMsg="Merci de cocher la case concernant l'utilisation des données."}console.log(errorMsg);if($(this).val().length<=0){ok=false;let idError=$(this).attr("id")+"-error";$(this).attr("aria-describedby",idError);let messageError='<p class="s-parrainage__error js-parrainage-error" id="'+idError+'">Merci de remplir ce champ.</p>';$(messageError).insertAfter($(this))}else{$(this).removeAttr("aria-describedby")}});if(ok){$("#popup").html("");$("#popup").append($("<button type='button' id='annuler' class='s-parrainage__popup-close js-parrainage-close'><i class='icomoon icon-cross' aria-hidden='true'></i><span class='visuallyhidden'>Annuler</span></button>"));$("#popup").append($("<h2 class='s-parrainage__popup-title' id='popupParrainageTitle'><span>Avant d’envoyer l’invitation, petite vérification des adresses mail des personnes parrainées : </span></h2>"));$("#popup").append($("<ul id='recap' class='s-parrainage__popup-list'></ul>"));$("#popup").append($("<p>Merci de prévenir la personne parrainée que vous avez communiqué son mail.</p>"));$("#popup").append($("<button type='button' id='valider' class='btnJaune'>C'est tout bon !</button>"));let aMail=[];let aPrenom=[];let aNom=[];$(".FLL_MAIL:not(.noRecap)").each(function(){if($(this).val()!=""){aMail.push($(this).val())}});$(".FLL_PRENOM:not(.noRecap)").each(function(){if($(this).val()!=""){aPrenom.push($(this).val())}});$(".FLL_NOM:not(.noRecap)").each(function(){if($(this).val()!=""){aNom.push($(this).val())}});for(i=0;i<aMail.length;i++){var nouvelleDiv=$("<li></li>");var str=$("<span>"+aPrenom[i]+" "+aNom[i]+" : "+aMail[i]+"</span>");nouvelleDiv.append(str);$("#popup #recap").append(nouvelleDiv)}$("#popup, #overlay").fadeIn();gam.pab.trapFocusModal($("#popup"));$("#annuler").click(function(){$("#popup, #overlay").fadeOut();$(".js-parrainage-form .submit").trigger("focus")});$("#valider").click(function(){$(".js-parrainage-form").submit()})}else{if(errorMsg!==""){window.alert(errorMsg)}}})}}};$(gam.init);